# เอกสารโค้ด: route-crud.js

## 1. ชื่อไฟล์
**route-crud.js**

## 2. ภาพรวม
ไฟล์นี้เป็นส่วนหนึ่งของระบบจัดการเส้นทางรถไฟ (Route Management) โดยใช้ IndexedDB ในการเก็บข้อมูลเส้นทาง  
ไฟล์นี้มีฟังก์ชันหลักในการสร้าง (Create), อัปเดต (Update), ลบ (Delete) และแสดงผล (Read/Display) ข้อมูลเส้นทาง พร้อมทั้งคำนวณจำนวนที่นั่งที่ว่างจากข้อมูลการจองตั๋ว

## 3. รายละเอียดฟังก์ชันและการทำงาน

- **openDB()**  
  ฟังก์ชันนี้เปิดหรือสร้างฐานข้อมูล IndexedDB ที่ชื่อว่า "RouteDB" พร้อมกับสร้าง Object Store "routes" หากยังไม่มี  
  ใช้ Promise เพื่อจัดการกับการเปิดฐานข้อมูลและรองรับการอัปเกรด

- **clearInputs()**  
  ฟังก์ชันสำหรับล้างข้อมูลใน input fields เมื่อดำเนินการเสร็จสิ้นแล้ว

- **createRoute()**  
  รับค่าจากฟอร์มและตรวจสอบความถูกต้อง ก่อนเพิ่มข้อมูลเส้นทางใหม่ลงใน Object Store  
  กำหนดจำนวนที่นั่งเริ่มต้น (number_of_seat) เป็น 48  
  แสดงข้อความแจ้งเตือนเมื่อสร้างเส้นทางสำเร็จหรือเกิดข้อผิดพลาด

- **updateRoute()**  
  รับค่า Route ID และข้อมูลที่ต้องการแก้ไข จากนั้นค้นหาข้อมูลเส้นทางใน IndexedDB  
  หากพบข้อมูลจะทำการอัปเดตค่าต่าง ๆ (departure, destination, date, time) ตามที่ระบุไว้

- **deleteRoute()**  
  รับค่า Route ID จาก input แล้วทำการลบเส้นทางออกจากฐานข้อมูล  
  แสดงข้อความแจ้งเตือนหลังการลบและทำการล้างข้อมูล input

- **displayRoutes()**  
  ดึงข้อมูลเส้นทางทั้งหมดจาก IndexedDB แล้วแสดงผลในรูปแบบตาราง  
  ฟังก์ชันนี้รวมถึงการคำนวณจำนวนที่นั่งว่าง (available seats) โดยใช้ฟังก์ชัน **getBookedSeats()**

- **getBookedSeats(routeID)**  
  ฟังก์ชันช่วยสำหรับการดึงจำนวนที่นั่งที่ถูกจองสำหรับเส้นทางที่ระบุจากฐานข้อมูล TicketDB  
  ใช้ Promise ในการทำงานร่วมกับการเปิด cursor ใน IndexedDB

## 4. วิธีการใช้งาน
- เมื่อ DOM โหลดแล้วจะทำการเปิดฐานข้อมูลและแสดงรายการเส้นทางโดยอัตโนมัติ
- ปุ่มสำหรับสร้าง, ค้นหา, อัปเดต และลบเส้นทางจะถูกผูกกับ event listener เพื่อเรียกใช้ฟังก์ชันที่เกี่ยวข้อง
- เมื่อมีการดำเนินการใด ๆ (สร้าง, อัปเดต, ลบ) ระบบจะแสดงข้อความแจ้งเตือนและอัปเดตรายการเส้นทางทันที

## 5. ข้อสังเกต
- การใช้งาน IndexedDB ทำให้สามารถจัดการข้อมูลในฝั่ง client ได้โดยไม่ต้องพึ่งพา server
- ควรตรวจสอบความถูกต้องของข้อมูลจากฟอร์มก่อนการดำเนินการกับฐานข้อมูล
- การคำนวณจำนวนที่นั่งว่างนั้นขึ้นอยู่กับการดึงข้อมูลจาก TicketDB ซึ่งต้องมีการจัดการให้ถูกต้อง
