# เอกสารโค้ด: ticket-ordered-history.js

## 1. ชื่อไฟล์
**ticket-ordered-history.js**

## 2. ภาพรวม
ไฟล์นี้เป็นส่วนหนึ่งของระบบประวัติการสั่งซื้อบัตรโดยใช้ฐานข้อมูล IndexedDB ที่ชื่อว่า "TicketDB"  
ไฟล์นี้ทำหน้าที่ค้นหา (Search) และแสดงผลบัตรที่สั่งซื้อในรูปแบบตาราง พร้อมทั้งรองรับการกรองข้อมูลตามเงื่อนไขที่ผู้ใช้ระบุ

## 3. รายละเอียดฟังก์ชันและการทำงาน

- **openTicketDB()**  
  ฟังก์ชันสำหรับเปิดฐานข้อมูล "TicketDB" ซึ่งใช้ Promise ในการเปิดฐานข้อมูลและจัดการข้อผิดพลาด

- **searchTickets()**  
  ฟังก์ชันหลักในการค้นหาบัตรจากฐานข้อมูล  
  ดำเนินการผ่านการเปิด cursor ใน object store "tickets" เพื่อดึงข้อมูลบัตรทั้งหมด  
  หลังจากดึงข้อมูลเสร็จแล้วจะทำการกรองข้อมูลด้วยฟังก์ชัน **filterTickets()** จากนั้นแสดงผลด้วย **renderTickets()**

- **filterTickets(tickets)**  
  ฟังก์ชันกรองข้อมูลบัตรตามเงื่อนไขที่ผู้ใช้ระบุ (เช่น ticketID, routeID, userID, totalPrice, และ seatFilter)  
  หากไม่มีเงื่อนไขการกรอง จะคืนค่าทุกบัตรที่มีอยู่ในฐานข้อมูล

- **renderTickets(tickets)**  
  ฟังก์ชันสำหรับแสดงข้อมูลบัตรในรูปแบบตาราง HTML  
  แสดงรายละเอียดเช่น Ticket ID, Route ID, User ID, จำนวนที่นั่งที่จอง, รายชื่อที่นั่ง และราคารวม

## 4. วิธีการใช้งาน
- เมื่อ DOM โหลดแล้วจะทำการผูก event listener กับปุ่มค้นหา (searchBtn)  
- ฟังก์ชัน **searchTickets()** จะถูกเรียกใช้เพื่อดึงและแสดงข้อมูลบัตรทันที รวมถึงการกรองข้อมูลหากมีการระบุเงื่อนไข
- ข้อมูลที่แสดงในตารางจะอัปเดตอัตโนมัติเมื่อมีการค้นหาหรือเปลี่ยนแปลงเงื่อนไข

## 5. ข้อสังเกต
- การเปิดฐานข้อมูลและดึงข้อมูลด้วย cursor ใน IndexedDB ต้องจัดการกับข้อผิดพลาดอย่างรอบคอบ  
- การกรองข้อมูลในฟังก์ชัน **filterTickets()** ควรมีความแม่นยำและรองรับการค้นหาที่หลากหลาย  
- การแสดงผลในรูปแบบตารางช่วยให้ผู้ใช้สามารถตรวจสอบข้อมูลการสั่งซื้อได้อย่างชัดเจน
