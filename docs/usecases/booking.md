# เอกสารโค้ด: booking.js

## 1. ชื่อไฟล์
**booking.js**

## 2. ภาพรวม
ไฟล์นี้จัดการหน้าการจองตั๋ว (Booking) โดยค้นหาเส้นทางจากฐานข้อมูล RouteDB ตามเงื่อนไขที่ผู้ใช้ระบุ (departure, destination, time)  
นอกจากนี้ยังคำนวณจำนวนที่นั่งว่างโดยอิงจากข้อมูลการจองใน TicketDB และแสดงผลในรูปแบบตาราง พร้อมปุ่ม Book ให้ผู้ใช้เลือกจองเส้นทาง

## 3. รายละเอียดฟังก์ชันและการทำงาน
- **เปิดฐานข้อมูล:**  
  - ฟังก์ชัน `openRouteDB()` ใช้เปิด RouteDB  
  - ฟังก์ชัน `openTicketDB()` ใช้เปิด TicketDB เพื่อดึงข้อมูลการจอง

- **ค้นหาและกรองเส้นทาง:**  
  - รับค่าจากฟอร์มค้นหา (departure, destination, time)  
  - ดึงข้อมูลเส้นทางจาก RouteDB โดยใช้ cursor แล้วตรวจสอบเงื่อนไขว่าตรงกับที่ผู้ใช้ระบุหรือไม่

- **คำนวณจำนวนที่นั่งว่าง:**  
  - ใช้ฟังก์ชัน `getAvailableSeats()` โดยดึงข้อมูลจำนวนที่นั่งที่ถูกจองจาก TicketDB แล้วคำนวณที่นั่งว่างโดยลบจำนวนที่จองออกจากจำนวนที่นั่งทั้งหมด

- **แสดงผลเส้นทาง:**  
  - สร้างตารางแสดงข้อมูลเส้นทางรวมทั้งจำนวนที่นั่งว่าง  
  - หากที่นั่งว่างเพียงพอ แสดงปุ่ม Book เพื่อให้ผู้ใช้เลือกจอง

- **การจองเส้นทาง:**  
  - ฟังก์ชัน global `bookRoute()` ถูกเรียกเมื่อผู้ใช้คลิกปุ่ม Book  
  - บันทึกข้อมูลเส้นทางที่เลือกใน sessionStorage แล้วเปลี่ยนเส้นทางไปยังหน้าการเลือกที่นั่ง

## 4. วิธีการใช้งาน
- ผู้ใช้กรอกข้อมูลค้นหาเส้นทางและคลิกปุ่มค้นหา  
- ระบบจะค้นหาเส้นทางที่ตรงกับเงื่อนไขและแสดงผลในตาราง  
- ผู้ใช้สามารถคลิกปุ่ม Book บนเส้นทางที่ต้องการจอง ซึ่งจะนำไปสู่หน้าการเลือกที่นั่ง

## 5. ข้อสังเกต
- การคำนวณที่นั่งว่างต้องอิงข้อมูลจาก TicketDB ให้ถูกต้อง  
- ควรมีการจัดการ error ในการเปิดฐานข้อมูลหรือดึงข้อมูลจาก IndexedDB  
- การแสดงผลในรูปแบบตารางช่วยให้ผู้ใช้สามารถตรวจสอบข้อมูลเส้นทางและที่นั่งได้อย่างชัดเจน
