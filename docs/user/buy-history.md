# เอกสารโค้ด: buy-history.js

## 1. ชื่อไฟล์
**buy-history.js**

## 2. ภาพรวม
ไฟล์นี้ทำหน้าที่แสดงประวัติการซื้อบัตรของผู้ใช้ที่ล็อกอินอยู่  
ระบบจะดึงข้อมูลบัตรจากฐานข้อมูล TicketDB ผ่าน IndexedDB แล้วกรองเฉพาะบัตรที่ตรงกับ userID ของผู้ใช้ที่ล็อกอิน จากนั้นแสดงข้อมูลในรูปแบบตาราง

## 3. รายละเอียดฟังก์ชันและการทำงาน
- **ตรวจสอบการล็อกอิน:**  
  - ดึงข้อมูลผู้ใช้ที่ล็อกอินจาก sessionStorage ผ่าน key `loggedInUser`
  - หากไม่พบข้อมูลผู้ใช้ ระบบจะแจ้งเตือนและเปลี่ยนเส้นทางไปยังหน้า `/index.html`
  - หากพบข้อมูลจะทำการ parse JSON และดึง userID เพื่อนำไปใช้ค้นหาบัตร
- **ดึงข้อมูลบัตรจาก TicketDB:**  
  - เปิดฐานข้อมูล TicketDB ผ่าน IndexedDB  
  - ทำการเปิด cursor ใน object store `tickets`  
  - กรองข้อมูลบัตรโดยเปรียบเทียบ userID ของแต่ละบัตรกับ userID ของผู้ใช้ที่ล็อกอิน
- **แสดงผลข้อมูลบัตร:**  
  - สร้างตาราง HTML เพื่อแสดงรายละเอียดของบัตร เช่น Ticket ID, Route ID, จำนวนที่นั่งที่จอง, รายชื่อที่นั่ง และราคารวม
  - หากไม่มีบัตรที่ตรงกันจะแสดงข้อความแจ้งว่า "You have not purchased any tickets yet."

## 4. วิธีการใช้งาน
- ผู้ใช้ที่ล็อกอินจะสามารถเข้าถึงหน้าประวัติการซื้อบัตรได้  
- ระบบจะดึงและแสดงข้อมูลบัตรที่ตรงกับ userID ของผู้ใช้จาก TicketDB
- ผู้ใช้สามารถดูรายละเอียดการสั่งซื้อบัตรในรูปแบบตารางที่อ่านง่าย

## 5. ข้อสังเกต
- ควรมีการตรวจสอบ session ของผู้ใช้ก่อนการดึงข้อมูลจากฐานข้อมูล  
- การดึงข้อมูลด้วย cursor ใน IndexedDB ควรมีการจัดการข้อผิดพลาด (error handling) ให้เหมาะสม  
- การกรองข้อมูลบัตรตาม userID เป็นสิ่งสำคัญสำหรับความเป็นส่วนตัวและความปลอดภัยของผู้ใช้
